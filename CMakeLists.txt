cmake_minimum_required(VERSION 3.1)

project(dlsh)

set(CMAKE_BUILD_TYPE Release)

add_definitions(-DUSE_INTERP_RESULT -DUSE_TCL_STUBS)

if(WIN32)
	include_directories(c:/usr/local/include)
	link_directories(c:/usr/local/lib)
elseif(APPLE)
	add_definitions(-DMACOS -Dunix -DLINUX)
	include_directories(/usr/local/include)
	link_directories(/usr/local/lib)
elseif(CMAKE_SYSTEM_NAME STREQUAL "QNX")
	include_directories(../local/include)
	link_directories(../local/aarch64/lib)
        set(LABLIB lab)
	set(TCLLIB tclstub8.6)
	set(PDFLIB pdf)
	set(LZ4LIB lz4)
	set(ZLIB z)
else()
	add_definitions(-DLINUX)
	include_directories(${APP_DIR} /usr/local/include)
	link_directories(/usr/local/lib)
	set(TCL_INCLUDE_DIR /usr/include/tcl8.6)
	set(LIBDL dl)
endif()

include_directories(${TCL_INCLUDE_DIR} src)

###############################
# dlsh
###############################
add_library(dlsh SHARED src/dfana.c src/tcl_dlg.c src/dfevt.c src/dlsh_pkg.c src/tcl_df.c src/tcl_dm.c src/dlarith.c src/dmana.c src/tcl_dl.c )

if(WIN32)
if(CMAKE_SIZEOF_VOID_P EQUAL 8)
	set(DLSH dlsh64.lib)
	set(LABLIB lablib64.lib)
	set(ZLIB zdll64.lib)
	set(GLFW glfw3_64)
	set(TCLLIB c:/usr/local/lib/tclstub86.lib)
	set(CMAKE_EXE_MODULE_FLAGS "${CMAKE_EXE_LINKER_FLAGS} /NODEFAULTLIB:libcmt /NODEFAULTLIB:MSCVRT /def:${DEF_FILE}")
	set(APP_LIB "${CMAKE_CURRENT_SOURCE_DIR}/../build_win64/tacothread.lib")
	set(SPINE_LIB spine-c64.lib)
	set(NEWTON_LIB newton3_x64.lib)
	set(BINK_LIB bink2w64.lib)
elseif(CMAKE_SIZEOF_VOID_P EQUAL 4)
	set(DLSH dlsh.lib)
	set(LAB lablib.lib)
	set(GLFW glfw3dll)
	set(TCLLIB tclstub86.lib)
	set(CMAKE_EXE_MODULE_FLAGS "${CMAKE_EXE_LINKER_FLAGS} /NODEFAULTLIB:libcmt /NODEFAULTLIB:MSCVRT /def:${DEF_FILE}")
	set(APP_LIB "${CMAKE_CURRENT_SOURCE_DIR}/../build_win32/tacothread.lib")
	set(SPINE_LIB spine-c.lib)
	set(NEWTON_LIB newton3_x86.lib)
	set(BINK_LIB bink2w32.lib)
endif()
elseif(APPLE)
	set(TCLLIB tclstub8.6)
	set(PDFLIB pdf)	
	set(LZ4LIB lz4)
	set(ZLIB z)
	set(BUNDLE_LOAD "-dynamiclib")
else()
        set(LABLIB lab)
        set(TCLLIB tclstub8.6)
	set(PDFLIB pdf)	
	set(LZ4LIB lz4)
	set(ZLIB z)
endif()
target_link_libraries(dlsh ${TCLLIB} ${LABLIB} ${PDFLIB} ${LZ4LIB} ${ZLIB} )
